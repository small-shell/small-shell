<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>App Shell - small-shell.org</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/docco.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">small-shell.org</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Quick Start</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../quick_start_linux/" class="dropdown-item">Starting on Linux</a>
</li>
                                    
<li>
    <a href="../quick_start_linux_apache2/" class="dropdown-item">Use apache2 </a>
</li>
                                    
<li>
    <a href="../quick_start_Mac/" class="dropdown-item">Use macOS</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Shells</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">App Shell</a>
</li>
                                    
<li>
    <a href="../data_shell_tour/" class="dropdown-item">Data Shell</a>
</li>
                                    
<li>
    <a href="../app_shell_form/" class="dropdown-item">Create Form</a>
</li>
                                    
<li>
    <a href="../app_shell_custom/" class="dropdown-item">Create Custom App</a>
</li>
                                    
<li>
    <a href="../cook_book/" class="dropdown-item">Cook Book</a>
</li>
                                    
<li>
    <a href="../automation_tour/" class="dropdown-item">E-cron (Automate & dataExchange)</a>
</li>
                                    
<li>
    <a href="../python_tour/" class="dropdown-item">Pyshell</a>
</li>
                                    
<li>
    <a href="../auth_shell/" class="dropdown-item">Auth</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../quick_start_Mac/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../data_shell_tour/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#app-shell" class="nav-link">App Shell</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#generate-base-app" class="nav-link">Generate Base App</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#default-web-server" class="nav-link">Default Web Server</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#add-initialize-user" class="nav-link">Add / initialize user</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#access-url-of-base-app" class="nav-link">Access URL of Base App</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#modify-dataset" class="nav-link">Modify dataset</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#insert-data-list-to-form" class="nav-link">Insert data list to Form</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#change-user-permission" class="nav-link">Change user permission</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#mvc-model" class="nav-link">MVC model</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#parse" class="nav-link">Parse</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#debug-techniques" class="nav-link">Debug techniques</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#tagging-on-base-app" class="nav-link">Tagging on Base App</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#command-api" class="nav-link">Command API</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#update-ssl-cert-and-key" class="nav-link">Update SSL cert and key</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#verified-environment" class="nav-link">Verified environment</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="app-shell">App Shell</h1>
<p>You can generate Web application with standard css design very easily. Basically each types of App is customizable but Base App is base layer of each application, so it's recommended to generate custom App for editting codes freely without any impact to base layer. as for portal page you can edit it very easily by using both markdown and HTML, please check <a href="../cook_book/">cookbook</a></p>
<h6 id="types-of-small-shell-app">Types of small-shell App</h6>
<table>
<thead>
<tr>
<th>Type</th>
<th>Authentication</th>
<th>View</th>
<th>Data  src</th>
<th>Code</th>
<th>Data Access</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#generate-base-app">Base App</a></td>
<td>Base64 encrypted Key</td>
<td>table,form,console,log,graph</td>
<td>All Databox</td>
<td>Basically Uneditable</td>
<td>Full &amp; Flat but control rw/ro permission</td>
</tr>
<tr>
<td><a href="../app_shell_form/">Web Form</a></td>
<td>No auth</td>
<td>Web form</td>
<td>Specific Databox</td>
<td>Editable</td>
<td>Just push new data through dedicated Form</td>
</tr>
<tr>
<td><a href="../app_shell_custom/">Shared Pass App</a></td>
<td>Shared Pass Code</td>
<td>portal,table,form,log</td>
<td>Specific Databox</td>
<td>Editable</td>
<td>Limitted &amp; controllable</td>
</tr>
<tr>
<td><a href="../app_shell_custom/">Key App</a></td>
<td>Base64 encrypted Key</td>
<td>portal,table,form,log</td>
<td>Specific Databox</td>
<td>Editable</td>
<td>Limitted &amp; controllable</td>
</tr>
<tr>
<td><a href="../app_shell_custom/">Other</a></td>
<td>Any #Oauth other</td>
<td>portal,table,form,log</td>
<td>Specific Databox</td>
<td>Editable</td>
<td>Limitted &amp; controllable</td>
</tr>
<tr>
<td><a href="../app_shell_custom/">No auth App</a></td>
<td>No authentication</td>
<td>portal,table,form</td>
<td>Specific Databox</td>
<td>Editable</td>
<td>Basically read only</td>
</tr>
</tbody>
</table>
<h4 id="required">required</h4>
<p>Please setup OS Env beorehand refering to <a href="../quick_start_linux/">Quick start</a>,
then start dialog by gen command.</p>
<h2 id="generate-base-app">Generate Base App</h2>
<p>Once OS setup has been done, let's tart to generate Base App through gen dialog.</p>
<pre><code>sudo /usr/local/small-shell/adm/gen -app 
#-&gt; dialog will be started
</code></pre>
<h2 id="default-web-server">Default Web Server</h2>
<p>small-shell contains default Web server that is written by javascipt using Node.js. it can be managed by systemctl command. ofcourse you can use your favorite Web server as well, in that case please select "other Web srv" and input detail to the dialog. we verified that small-shell can be worked without any problem on Apache and Nginx.</p>
<h3 id="define-dataset-for-web-app">Define dataset for Web App</h3>
<p>For the first step, it's required to define dataset that will be refered from App. "label" will be shown in the table and Form of App.
you can also define parameters of select, radio or checkbox in the dialog. by the way, there is 2 type of primary key. please check detail on <a href="../data_shell_tour/#feature">databox feature</a></p>
<pre><code>sudo /usr/local/small-shell/adm/gen -databox
</code></pre>
<p>This is exmpale of dialog result.</p>
<pre><code>Databox will be generated by following order, please check it
-----------------------------------------------------------------

Databox Name:inventory.db
#primary_key
name=&quot;item_name&quot;
label=&quot;Item Name&quot;
type=&quot;text&quot;
option=&quot;required&quot;

#key(col2)
name=&quot;description&quot;
label=&quot;Description&quot;
type=&quot;text&quot;
option=&quot;&quot;

#key(col3)
name=&quot;category&quot;
label=&quot;Category&quot;
type=&quot;select&quot;
params=&quot;PC,network_device,audio_visual,furniture,other&quot;
option=&quot;required&quot;

#key(col4)
name=&quot;num&quot;
label=&quot;Num&quot;
type=&quot;number&quot;
option=&quot;required&quot;

-----------------------------------------------------------------
</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>"Data Type" is same as HTML type attribute and you can change parameter easily. besides there is special type that's defined for small-shell Web application framework.</p>
<p><b>type: select and radio</b>  <br />
You can define parameters in the dialog. and change them anytime later.</p>
<p><b>type: pdls</b><br />
"pdls" means primary data list. If you want to import primary key values as datalist from other databox, please set type as pdls in the dialog. please see detail <a href="./#insert-data-list-to-form">pdls</a></p>
<p><b>type: mls</b> <br />
"mls" means member list. if you want to import user who already created in small-shell, please use mls.</p>
</div>
<p>This is image of dataset inserted to the App. 
<img alt="Screenshot" src="../img/created_form.png" /></p>
<p>Parameters that is defined in the dialog will be inserted like below.
<img alt="Screenshot" src="../img/select_image.png" /></p>
<h2 id="add-initialize-user">Add / initialize user</h2>
<p>Following example is adding user name "test", "test" can initialize and get base64 key by accessing the URL that is generated by ops command. the key will be stored to end user browser automatically using localstorage.</p>
<pre><code>sudo /usr/local/small-shell/adm/ops add.usr:test
-------------------------------------------------------------------------------
This is the URL for key initialization and generation for test on Base App
-------------------------------------------------------------------------------
https://${server}/cgi-bin/auth.base?initialize=*****fce76b37e4e93b7605022da52e6ccc26fd2,4c5a2ae68d20e530b4ce457c71eae42590135268e1fb933a945f7e188678ccf4
</code></pre>
<p><img alt="Screenshot" src="../img/initialize_key.png" /></p>
<h2 id="access-url-of-base-app">Access URL of Base App</h2>
<p>As you already checked, access URL is shown in the result of ops add command. if you are using small-shell default Web server, URL must be ${FQDN}/base.</p>
<pre><code>e.g.) https://ec2-XX-XX-XX-XX.XXXX.com/base
</code></pre>
<h4 id="re-generate-user-key">Re-generate User key</h4>
<p>If end user lost their key, you can generate URL for re-generating key.</p>
<pre><code>sudo /usr/local/small-shell/adm/ops initialize.usr:test
-------------------------------------------------------------------------------
This is the URL for key initialization and generation for test on Base App
-------------------------------------------------------------------------------
https://ec2-XX-XX-XX-XX.XXXX.com/cgi-bin/auth.base?initialize=*****fce76b37e4e93b7605022da52e6ccc26fd2,4c5a2ae68d20e530b4ce457c71eae42590135268e1fb933a945f7e188678ccf4
</code></pre>
<h2 id="modify-dataset">Modify dataset</h2>
<p>You can modify dataset anytime later.</p>
<h5 id="add-del-column">Add | Del Column</h5>
<p>Column can be added or deleted by gen command</p>
<pre><code>sudo /usr/local/small-shell/adm/gen -addcol
sudo /usr/local/small-shell/adm/gen -delcol
</code></pre>
<h5 id="change-label">Change label</h5>
<p>Label definition can be modified directly</p>
<pre><code>(e.g.) change inventory.db col2 label
sudo vi /usr/local/small-shell/databox/inventory.db/def/col2

--code--
name="description"
label="description"
type="text"
option=""
--------
</code></pre>
<h5 id="change-params-of-select-type-or-radio">Change params of select type or radio</h5>
<p>Params can be also modified directly</p>
<pre><code>(e.g.) change inventory.db col3
sudo vi /usr/local/small-shell/databox/inventory.db/def/col3

--code--
name="item_type"
label="item_type"
type="select"
params="PC,network_device,audio_visual,furniture,other"
option="required"
--------
</code></pre>
<h2 id="insert-data-list-to-form">Insert data list to Form</h2>
<p>You can import primary data list from other databox to the Form using "pdls".
following is an example that can show how you can utilize pdls.</p>
<h4 id="typepdls">type=pdls</h4>
<p>Import target: inventory.db 
New databox : request.db &lt;- import item list</p>
<pre><code>sudo /usr/local/small-shell/adm/gen -databox

# result of dialog
-----------------------------------------------------------------
databox_name:order.db
#primary_key
name=&quot;hashid&quot;
label=&quot;hashid&quot;
type=&quot;text&quot;
option=&quot;required&quot;

#key(col2)
name=&quot;item&quot;
label=&quot;item&quot;
type=&quot;pdls&quot;
pdlsbox=&quot;inventory.db&quot;
option=&quot;required&quot;

#key(col3)
name=&quot;num&quot;
label=&quot;Num of item&quot;
type=&quot;number&quot;
option=&quot;required&quot;
-----------------------------------------------------------------
</code></pre>
<p>Image of request Form using pdls is as following.
<img alt="Screenshot" src="../img/pdls.png" /></p>
<h4 id="addkvl">+addkvl</h4>
<p>Besides importing primary key value, you can import 1 other column as well by adding addkvl param manually. following example is adding item_type to the importing value.</p>
<pre><code># edit target coumn, in this example col3 is target.
sudo vi /usr/local/small-shell/databox/order.db/def/col2

--code--
name=&quot;item&quot;
label=&quot;item&quot;
type=&quot;pdls&quot;
pdlsbox=&quot;inventory.db&quot;
option=&quot;required&quot; 
addkvl=&quot;category&quot; #&lt;- add by manually
--------
</code></pre>
<p><img alt="Screenshot" src="../img/addkvl.png" /></p>
<h2 id="change-user-permission">Change user permission</h2>
<p>You can cpontroll user permission. user default permission is "read/write"</p>
<pre><code># read write permission
sudo /usr/local/small-shell/adm/ops set.attr:$user{rw}

# read only permission
sudo /usr/local/small-shell/adm/ops set.attr:$user{ro}

e.g)
# change test user to read only permission
sudo /usr/local/small-shell/adm/ops set.attr:test{ro}
</code></pre>
<h2 id="mvc-model">MVC model</h2>
<p>You can customize small shell by understanding similar MVC model concept.</p>
<h5 id="basic-structure">Basic structure</h5>
<pre><code># Controller 
$cgi_dir (/var/www/cgi-bin #default) 
 |- base # Base App controller
 |- auth.base # Base App authenticator
 |- api
 |- e-cron
 |- $app # custom App controller
 |- auth.$app # custom App authenticator

# Model
$bin (/var/www/bin)
 |- scripts # work as Model
 |- parse.sh #it will be used for parsing posted params

# View
$def (/var/www/def)
 |- .html.def # store view definitions of html

# Other 
$static_dir (/var/www/html)
 |- index.html 
 |- libraries (css,js)

$app (/var/www/app)
 |-index.js # small-shell default web server
 |-log # default server log

$tmp (/var/www/tmp)
</code></pre>
<h5 id="data-flow">Data flow</h5>
<p>Following is a data flow of App shell it will be used as Base App or Custome App
<img alt="Screenshot" src="../img/standard_flow.png" /></p>
<h5 id="url-design">URL design</h5>
<p>Query string will be loaded same name of valiables in the App</p>
<pre><code>https://$[server]/cgi-bin/${app}?req=get&amp;databox=inventory.db&amp;id=1234 ..

These query string will be loaded as following value in the App
-&gt; req=get
-&gt; databox=inventory.db
-&gt; id=1234
</code></pre>
<h5 id="routing-in-controller-base-app">Routing in controller # Base App</h5>
<p>Routings to the bin/scripts are defined in the controller script.</p>
<pre><code>sudo vi $cgi-bin/base (e.g. /var/www/cgi-bin/base)

--code--
#----------------------------
# routing to bin/scripts
#----------------------------

#e.g. get request
case &quot;$req&quot; in

&quot;get&quot;)
    ../bin/get.sh databox:$databox id:$id session:$session ;;
--------
</code></pre>
<h5 id="action-scripts-model">Action scripts (model)</h5>
<p>Action scripts will work with folloging STEPS</p>
<ol>
<li>Load parameters from QUERY string</li>
<li>Load parameters from POST data</li>
<li>Call DATA shell</li>
<li>Insert dynamic contents to %%tags</li>
<li>Render pure HTML to client</li>
</ol>
<h6 id="load-query-string-eg-databoxidsession-that-will-be-passsed-from-controller-as-parameter">Load QUERY string (e.g. $databox,$id,$session) that will be passsed from controller as parameter</h6>
<pre><code>sudo vi ${bin}/get.sh (e.g. /var/www/bin/get.sh)

--code--
# load query string param
for param in $(echo $@)
do

  if [[ $param == databox:* ]]; then
    databox=$(echo $param | $AWK -F&quot;:&quot; '{print $2}')
  fi  

  if [[ $param == id:* ]]; then
    id=$(echo $param | $AWK -F&quot;:&quot; '{print $2}')
  fi

  if [[ $param == session:* ]]; then
    session=$(echo $param | $AWK -F&quot;:&quot; '{print $2}')
  fi

done
-------
</code></pre>
<h6 id="load-post-data-that-is-stored-by-controller-tmpsessionkey">Load POST data that is stored by controller ../tmp/${session}/${key}</h6>
<p>(e.g. item_name)</p>
<pre><code>sudo vi ${bin}/get.sh (e.g. /var/www/bin/get.sh)

--code--
item_name=$(cat ../tmp/${session}/item_name)
--------
</code></pre>
<h6 id="generate-data-by-calling-data_shell-with-html-format-eg-accesing-to-inventorydb">Generate data by calling DATA_shell with html format (e.g. accesing to inventory.db)</h6>
<pre><code>sudo vi ${bin}/get.sh (e.g. /var/www/bin/get.sh)

--code--
sudo -u small-shell ${small_shell_path}/bin/DATA_shell session:$session pin:$pin databox:inventory.db \
action:get id:$id keys:all format:html_tag &gt; ../tmp/${session}/dataset
--------
</code></pre>
<h6 id="render-html-with-inserting-dynamic-contents-to-tags-eg-datasethtml_tag-from-inventorydb">Render HTML with inserting dynamic contents to %%tags (e.g. dataset{html_tag} from inventory.db)</h6>
<pre><code>sudo vi ${bin}/get.sh (e.g. /var/www/bin/get.sh)

--code--
cat ../def/get.html.def | $SED &quot;s/^ *&lt;/&lt;/g&quot; \
| $SED &quot;/%%dataset/r ../tmp/${session}/dataset&quot; \
| $SED &quot;s/%%dataset//g&quot;
--------
</code></pre>
<h5 id="htmldef-view">html.def (view)</h5>
<p>Just write down pure HTML. %%tag can be replaced to dynamic contents</p>
<pre><code>sudo vi ${def}/${htmldef} (e.g. /var/www/def/get.html.def)

--code--
&lt;h2&gt;Data.values&lt;/h2&gt;
&lt;p&gt;&lt;b&gt;#ID &lt;/b&gt;%%id&lt;/p&gt;
&lt;/div&gt;
&lt;form method=&quot;post&quot; action=&quot;./base?%%params&amp;req=set&amp;id=%%id&amp;post=yes&quot; onclick=&quot;document.charset='utf-8';&quot;&gt;
&lt;ul&gt;
%%dataset
&lt;/ul&gt;
&lt;button class=&quot;button&quot; type=&quot;submit&quot;&gt;UPDATE&lt;/button&gt;
&lt;/form&gt;      
--------
</code></pre>
<h5 id="rendered-pure-html">Rendered Pure HTML</h5>
<p>Once bin/script is executed by accessing the page, pure HTML will be rendered by inserting dynamic contents to %%dataset tag.</p>
<pre><code>&lt;h2&gt;Data.values&lt;/h2&gt;
&lt;p&gt;&lt;b&gt;#ID &lt;/b&gt;81416a688e358d92b2a9f2ad412cb5fa60cae8e04f611335a14c6dafe2614f1e&lt;/p&gt;
&lt;/div&gt;
&lt;form method=&quot;post&quot; action=&quot;./base?session=54c59a2567b0ac722855c801c7008a071b386f7b63ce2d6c138f5e0d94350037&amp;pin=29449&amp;databox=inventory.db&amp;req=set&amp;id=81416a688e358d92b2a9f2ad412cb5fa60cae8e04f611335a14c6dafe2614f1e&amp;post=yes&quot; onclick=&quot;document.charset='utf-8';&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;label&gt;item_name (Fixed)&lt;/label&gt;
&lt;p&gt;small egg&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;label&gt;description&lt;/label&gt;
&lt;input type=&quot;text&quot; name=&quot;description&quot; value=&quot;It's a small world egg&quot; &gt;
&lt;/li&gt;
&lt;li&gt;
&lt;label&gt;stock&lt;/label&gt;
&lt;input type=&quot;hidden&quot; name=&quot;stock&quot; value=&quot;&quot;&gt;
&lt;input type=&quot;checkbox&quot; name=&quot;stock&quot; value=&quot;yes&quot; checked=&quot;checked&quot;&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;label&gt;item_type&lt;/label&gt;
&lt;select name=&quot;item_type&quot; &gt;
&lt;option value=&quot;other&quot;&gt;other&lt;/option&gt;
&lt;option value=&quot;book&quot;&gt;book&lt;/option&gt;
&lt;option value=&quot;furniture&quot;&gt;furniture&lt;/option&gt;
&lt;option value=&quot;electric&quot;&gt;electric&lt;/option&gt;
&lt;option value=&quot;other&quot;&gt;other&lt;/option&gt;
&lt;/select&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;button class=&quot;button&quot; type=&quot;submit&quot;&gt;UPDATE&lt;/button&gt;
&lt;/form&gt;
</code></pre>
<h2 id="parse">Parse</h2>
<p>parse.sh will be used for parsing posted data. posted data will be stored to files in output dir.</p>
<h5 id="path">PATH</h5>
<pre><code>${bin}/parse.sh (e.g. /var/www/bin/parse.sh)
</code></pre>
<h5 id="usage">Usage</h5>
<pre><code>parse.sh $session $type
</code></pre>
<h5 id="input">input</h5>
<pre><code>../tmp/${session}/input (e.g. /var/www/tmp/${session}/input)
</code></pre>
<h5 id="type">type</h5>
<pre><code>urlenc # normal post
multipart # multipart/form-data
binary  # binary post
json #json post
</code></pre>
<h5 id="output">output</h5>
<p>Output will be dumped to ../tmp/${session} directory</p>
<pre><code># parsed key value
ls /var/www/tmp/${session}/${key}

# get key's value
cat /var/www/tmp/${session}/${key}

# parsed file
ls /var/www/tmp/${session}/binary_file/file_name #contain file name
ls /var/www/tmp/${session}/binary_file/binary.data #binary data
</code></pre>
<h4 id="parse-usage-in-the-app">Parse usage in the App</h4>
<pre><code># sudo vi ${cgi_dir}/base
sudo vi /var/www/cgi-bin/base

--code--
# dump POST data
if [ &quot;$(echo $REQUEST_METHOD | grep -i &quot;POST&quot;)&quot; ];then

  if [ &quot;$(echo $CONTENT_TYPE | grep &quot;application/json&quot;)&quot; ];then
    method=json
  elif [ &quot;$(echo $CONTENT_TYPE | grep &quot;multipart/form-data&quot;)&quot; ];then
    method=multipart
  elif [ &quot;$(echo $CONTENT_TYPE | grep &quot;application/octet-stream&quot;)&quot; ];then
    method=data-binary
  else
    method=urlenc
  fi

  mkdir ../tmp/${session}
  # dump posted data
  dd bs=${CONTENT_LENGTH} of=../tmp/${session}/input 2&gt;/dev/null
  ../bin/parse.sh $session $method

fi
--------
</code></pre>
<h2 id="debug-techniques">Debug techniques</h2>
<h5 id="check-error-log">Check error log</h5>
<pre><code># small-shell default web
sudo tail -f /var/www/log/srvdump.log

# ubuntu &amp; apache2
sudo tail -f /var/log/apache2/error_log
</code></pre>
<h5 id="posted-param-and-command-result-check">Posted param and command result check</h5>
<p>comment out tmp dir removal</p>
<pre><code>sudo vi /var/www/bin/set.sh

--code--
#if [ "$session" ];then
#  rm -rf ../tmp/${session}
#fi
--------
</code></pre>
<p>Then check /var/www/tmp, you can check posted params after post data on tmp dir</p>
<pre><code>e.g.
$ ls /var/www/tmp
b5ee3b232da9615cb7dda3838cc689aea77b323c3623c34c509d541eef9800eb
$ cd b5ee3b232da9615cb7dda3838cc689aea77b323c3623c34c509d541eef9800eb
$ ls 
category  databox_list  issue_link  result  status
</code></pre>
<h5 id="check-posted-param">check posted param</h5>
<pre><code>$ cat status
available
</code></pre>
<h5 id="check-result">check result</h5>
<pre><code>$ cat result
successfully set 181210f8f9c779c26da1d9b2075bde0127302ee0e3fca38c9a83f5b1dd8e5d3b category
info: issue_link value{} is same as original value
info: status value{available} is same as original value
</code></pre>
<h5 id="exec-command-check">Exec Command check</h5>
<p>show exec command by echo "", then you can check command and parameters. it can be chcked on browser.</p>
<pre><code>sudo vi ${bin}/${script} (e.g. /var/www/bin/set.sh)

--code--
# set and get %%result contents
sudo -u small-shell ${small_shell_path}/bin/DATA_shell session:$session pin:$pin databox:$databox \
action:set id:$id keys:$keys input_dir:../tmp/${session} format:html_tag &gt; ../tmp/${session}/result

# add echo command &amp; sleep to show command
echo "sudo -u small-shell ${small_shell_path}/bin/DATA_shell session:$session pin:$pin databox:$databox \
action:set id:$id keys:$keys input_dir:../tmp/${session} format:html_tag &gt; ../tmp/${session}/result"    
sleep 10
--------
</code></pre>
<p>You could find specific command that will be executed by bin/script (e.g. set.sh), following is an example executing set.sh on Base App.
<img alt="Screenshot" src="../img/command_debug.png" /></p>
<h5 id="exec-command-with-debug-mode">Exec command with debug mode</h5>
<pre><code># Exec command on bash directly
authkey="XXXX" please input your authkey
sudo -u small-shell bash -x /usr/local/small-shell/bin/DATA_shell authkey:$authkey + "parameters that shown on the page"
</code></pre>
<h2 id="tagging-on-base-app">Tagging on Base App</h2>
<p>You can add tag to the table. the tag can be used for searching with specific word.</p>
<h5 id="add-tag-thoroug-small-shell-command">Add tag thoroug small-shell command</h5>
<pre><code>sudo /usr/local/small-shell/adm/ops add.tag:$databox{word}
(e.g.)
sudo /usr/local/small-shell/adm/ops add.tag:item.db{test}
</code></pre>
<h5 id="delete-tag-on-small-shell-server">Delete tag on small-shell server</h5>
<pre><code>sudo /usr/local/small-shell/adm/ops del.tag:$databox{word}
(e.g.)
sudo /usr/local/small-shell/adm/ops del.tag:item.db{test}
</code></pre>
<p>This is example of tag of word{test},
If you click the tag, search result will be shown.
<img alt="Screenshot" src="../img/table_tag.png" /></p>
<h2 id="command-api">Command API</h2>
<p>You can access command API from external systems. command API priviledge is read only as default. </p>
<h4 id="confirm-api-key">confirm API key</h4>
<pre><code>sudo cat /usr/local/small-shell/web/base | grep api_authkey
</code></pre>
<h4 id="confirm-api-url">confirm API url</h4>
<pre><code>sudo cat /usr/local/small-shell/web/base | grep command_api
</code></pre>
<h4 id="change-permission-to-rw-optional">Change permission to rw (optional)</h4>
<p>if you want to set data from external system, please change permission for api user. </p>
<pre><code>sudo /usr/local/small-shell/adm/ops set.attr:api{rw}
</code></pre>
<h4 id="access-to-command-api">Access to command API</h4>
<p>please access command API from external system, you can access the data using curl very easily.</p>
<h4 id="from-linux-shell-with-curl">From Linux shell with curl</h4>
<pre><code>api_authkey="XXXX"
command_api="https://XXXX/cgi-bin/api"
databox="XXXX"

(e.g.) exec "grep test" command to index
curl -X GET "${command_api}?databox=$databox&amp;command=grep_test" -H "X-small-shell-authkey:$api_authkey"

(e.g.) get DATA
id="0283da60063abfb3a87f1aed845d17fe2d9ba8c780b478dc4ae048f5ee97a6d5" #please input id that you want to get
curl -X GET "${command_api}?databox=$databox&amp;keys=all&amp;id=$id" -H "X-small-shell-authkey:$api_authkey"

(e.g.) push DATA
sudo /usr/local/small-shell/adm/ops set.attr:api{rw}
id="new" #please input id that you want to set    
curl -X POST "${command_api}?databox=$databox&amp;id=$id" -H "X-small-shell-authkey:$api_authkey" -H "Content-Type: application/json" -d '{"item_name":"item1", "description":"test"}'
</code></pre>
<h4 id="from-windows-power-shell-with-curl">From Windows power shell with curl</h4>
<pre><code>@External system (windwos)
$api_authkey="XXXX" #please input authkey that you confirmed
$command_api="https://XXXX/cgi-bin/api"
$databox="XXXX"

(e.g.) exec grep command to index
curl.exe -X GET "${command_api}?command=grep_test&amp;databox=$databox" -H "X-small-shell-authkey:$api_authkey" -H "X-small-shell-databox:$databox"

(e.g.) get DATA
$id="0283da60063abfb3a87f1aed845d17fe2d9ba8c780b478dc4ae048f5ee97a6d5" #please input id that you want to get
curl.exe -X GET "${command_api}?keys=all&amp;id=$id&amp;databox=$databox" -H "X-small-shell-authkey:$api_authkey" -H "X-small-shell-databox:$databox"
</code></pre>
<h2 id="update-ssl-cert-and-key">Update SSL cert and key</h2>
<p>When you update SSL cert and key for small-shell default Web server, you need to re-generate Base App by gen command. all service will be down during this upgrade. by the way, if you deployed automated cert with <a href="../cook_book/#automate-ssl-cert-deployment">cookbook</a>, you don't need to do anything manually.</p>
<pre><code>/usr/local/small-shell/gen -app
-----------------------------------------------
Type of App (1.BASE | 2.FORM | 3.CUSTOM): 1
------------------------------------------------
-&gt; dialog will be started
</code></pre>
<h2 id="verified-environment">Verified environment</h2>
<pre><code>OS: Ubuntu 2X (recommnded), Debian 1X, macOS Tahoe, Almalinux 9.X, CentOS 7, RHEL 8
bash: 4.X
Web : Node.js 20, 19.X + express 4.X , Apache 2.X , nginx 1.X    
curl: 7.X

# REQUIRED commands
Core commands : sha256sum, flock, base64
awk : above 3 that can use "IGNORECASE = 1;" option
sed : above 4.2.2 that can use "-z" option
PHP : any version which have PHP url encyption libraries
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=G-ECCJ0KEWFN"></script>
        <script src="../js/analytics.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
